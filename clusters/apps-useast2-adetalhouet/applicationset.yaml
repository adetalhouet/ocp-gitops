apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
 name: cluster-config
 namespace: openshift-gitops
spec:
  generators:
# the list generator impose having cluster and url keys...
# should be fixed by https://github.com/argoproj-labs/applicationset/issues/162
  - list:
      elements:
        - cluster: app-us-east-2
          url: https://kubernetes.default.svc
          values:
            name: 01-openshift-gitops
            wave: '1'
        - cluster: app-us-east-2
          url: https://kubernetes.default.svc
          values:
            name: 02-sealed-secrets
            wave: '2'
        - cluster: app-us-east-2
          url: https://kubernetes.default.svc
          values:
            name: 03-letsencrypt-certs
            wave: '3'
        - cluster: app-us-east-2
          url: https://kubernetes.default.svc
          values:
            name: 04-local-storage-operator
            wave: '4'
        # - cluster: app-us-east-2
        #   url: https://kubernetes.default.svc
        #   values:
        #     name: 05-openshift-container-storage
        #     wave: '5'
        # - cluster: app-us-east-2
        #   url: https://kubernetes.default.svc
        #   values:
        #     name: 06-rhsso
        #     wave: '6'
        # - cluster: app-us-east-2
        #   url: https://kubernetes.default.svc
        #   values:
        #     name: 07-oauth
        #     wave: '7'
        # - cluster: app-us-east-2
        #   url: https://kubernetes.default.svc
        #   values:
        #     name: 08-openshift-elasticsearch
        #     wave: '8'
        # - cluster: app-us-east-2
        #   url: https://kubernetes.default.svc
        #   values:
        #     name: 09-openshift-logging
        #     wave: '9'
  template:
    metadata:
      name: '{{values.name}}'
      namespace: openshift-gitops
      annotations:
        argocd.argoproj.io/sync-wave: '{{values.wave}}'
        argocd.argoproj.io/hook: Sync
    spec:
      project: default
      source:
        repoURL: https://github.com/adetalhouet/ocp-gitops.git
        targetRevision: main
        path: 'apps/{{values.name}}'
      destination:
        server: '{{url}}'
      syncPolicy:
        automated:
          prune: false
          selfHeal: true